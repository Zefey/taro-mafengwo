(wx.webpackJsonp=wx.webpackJsonp||[]).push([[13],{"31":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{"value":!0});var O=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function sliceIterator(e,t){var n=[],o=!0,a=!1,r=void 0;try{for(var i,s=e[Symbol.iterator]();!(o=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);o=!0);}catch(e){a=!0,r=e}finally{try{!o&&s.return&&s.return()}finally{if(a)throw r}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},f=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},o=function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e};function defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var a,r,i,D=n(0),T=function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}(D),s=n(1),c=n(4),u=n(5),l=n(32),p=n(33);function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}n(34);var d=n(12),g=(0,s.connect)(function(e){return{"user":e.user}},function(t){return{"update":function update(e){t((0,c.update)(e))},"getBanner":function getBanner(e){t((0,l.getBanner)(e))},"getTravel":function getTravel(e){t((0,u.getTravel)(e))},"getScenic":function getScenic(e){t((0,p.getScenic)(e))}}})((function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{"constructor":{"value":e,"enumerable":!1,"writable":!0,"configurable":!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(Index,D.Component),o(Index,[{"key":"_constructor","value":function _constructor(e){(function get(e,t,n){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,t);if(void 0===o){var a=Object.getPrototypeOf(e);return null===a?void 0:get(a,t,n)}if("value"in o)return o.value;var r=o.get;return void 0!==r?r.call(n):void 0})(Index.prototype.__proto__||Object.getPrototypeOf(Index.prototype),"_constructor",this).call(this,e),this.qqmapsdk=null,this.state={"statusBarHeight":0,"scrollTop":0,"tabViewData":[{"id":1,"name":"推荐阅读"},{"id":2,"name":"目的地"}],"tabViewIndex":1,"quickKnow":[],"routeData":[]},this.$$refs=new T.default.RefsArray}},{"key":"componentDidMount","value":function componentDidMount(){this.qqmapsdk=new d({"key":"RM6BZ-57A3O-OUWWO-SRK3I-JWHI7-POBVT"}),this.login(),this.location(),this.getSystemInfo()}},{"key":"componentWillReceiveProps","value":function componentWillReceiveProps(e){var t=this.props.user.locationCity!==e.user.locationCity,n=e.user.locationCity;t&&(console.log("localChange",t,n),this.props.getBanner({"type":1,"location":n}),this.props.getBanner({"type":2,"location":n}),this.props.getTravel({"location":n}),this.getQuickKnowList(n),this.getRouteList(n),this.props.getScenic({"location":n}))}},{"key":"componentWillUnmount","value":function componentWillUnmount(){}},{"key":"componentDidShow","value":function componentDidShow(){}},{"key":"componentDidHide","value":function componentDidHide(){}},{"key":"_createData","value":function _createData(e,t,n){var o=this;this.__state=e||this.state||{},this.__props=t||this.props||{};var a=this.$prefix,r=(0,D.genCompid)(a+"$compid__0"),i=O(r,2),s=i[0],c=i[1],u=(0,D.genCompid)(a+"$compid__1"),l=O(u,2),p=l[0],f=l[1],d=(0,D.genCompid)(a+"$compid__2"),g=O(d,2),_=g[0],y=g[1],m=this.__state,h=m.scrollTop,v=m.tabViewData,b=m.tabViewIndex,w=m.statusBarHeight,S=m.quickKnow,k=m.routeData,q=this.__props.user,B={"paddingTop":(T.default.$statusBarHeight||w)+"px"},x=(0,D.internal_inline_style)(B),I=v.map(function(e,t){e={"$original":(0,D.internal_get_original)(e)};var n="azzzz"+t;return o.anonymousFunc0Map[n]=function(){o.toggleTab(t)},{"_$indexKey":n,"$original":e.$original}});return D.propsManager.set({"scrollTop":h},c,s),0==b&&D.propsManager.set({},f,p),0!=b&&D.propsManager.set({"quickKnow":S,"routeData":k},y,_),Object.assign(this.__state,{"anonymousState__temp":"SearchBar","anonymousState__temp2":x,"loopArray0":I,"$compid__0":c,"$compid__1":f,"$compid__2":y,"user":q}),this.__state}},{"key":"anonymousFunc0","value":function anonymousFunc0(e){for(var t,n=arguments.length,o=Array(1<n?n-1:0),a=1;a<n;a++)o[a-1]=arguments[a];return this.anonymousFunc0Map[e]&&(t=this.anonymousFunc0Map)[e].apply(t,o)}}]),i=r=Index,r.$$events=["bindGetUserInfo","onScroll","anonymousFunc0"],r.$$componentPath="pages/index/index",a=i))||a;function Index(){var e,t,p;!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Index);for(var n=arguments.length,o=Array(n),a=0;a<n;a++)o[a]=arguments[a];return(t=p=_possibleConstructorReturn(this,(e=Index.__proto__||Object.getPrototypeOf(Index)).call.apply(e,[this].concat(o)))).$usedState=["anonymousState__temp","anonymousState__temp2","loopArray0","$compid__0","$compid__1","$compid__2","tabViewData","tabViewIndex","user","statusBarHeight","scrollTop","quickKnow","routeData","getBanner","getTravel","getScenic","update"],p.login=function(){T.default.login({"success":function success(e){e.code?T.default.request({"url":"https://api.weixin.qq.com/sns/jscode2session","data":{"appid":"wx5bd348ec3a45bb65","secret":"5c2e6371c4b7a118ce35fcc16bb6d602","js_code":e.code,"grant_type":"authorization_code"},"success":function success(e){console.log("login res",e.data),p.props.update(f({},p.props.user,e.data))},"fail":function fail(e){console.log("login err",e)}}):console.log("登录失败！"+e.errMsg)}})},p.location=function(){T.default.getLocation({"complete":function complete(e){console.log("getLocation",e),console.log("qqmapsdk",p.qqmapsdk),p.qqmapsdk&&p.qqmapsdk.reverseGeocoder({"location":{"latitude":e.latitude,"longitude":e.longitude},"success":function success(e){console.log("success",e);var t=e.result.ad_info.city;t=t.replace("市",""),p.props.update(f({},p.props.user,{"locationCity":t})),p.props.getBanner({"type":1,"location":t}),p.props.getBanner({"type":2,"location":t}),p.props.getTravel({"location":t}),p.getQuickKnowList(t),p.getRouteList(t),p.props.getScenic({"location":t})},"fail":function fail(e){console.log("fail",e),p.props.update(f({},p.props.user,{"locationCity":"定位失败"}))}})}})},p.getSystemInfo=function(){T.default.getSystemInfo().then(function(e){p.setState({"statusBarHeight":e.statusBarHeight||0})})},p.onScroll=function(e){var t=e.detail.scrollTop;p.setState({"scrollTop":t})},p.toggleTab=function(e){p.setState({"tabViewIndex":e})},p.getQuickKnowList=function(e){T.default.request({"url":"http://zefey.com:12345/mfw/quickKnowList","data":{"location":e},"success":function success(e){console.log("quickKnowList",e);for(var t=e.data.data,n=[],o={},a=0;a<t.length;a++)t[a].big_title&&(o[t[a].big_title]=[]);for(var r in o){var i={};i.name=r,n.push(i)}console.log("quickKnow expect",n),p.setState({"quickKnow":n})},"fail":function fail(e){console.log("getLocationList err",e)}})},p.getRouteList=function(e){T.default.request({"url":"http://zefey.com:12345/mfw/routeList","data":{"location":e},"success":function success(e){console.log("routeList",e);for(var t=e.data.data,n=[],o={},a=0;a<t.length;a++)t[a].title&&(o[t[a].title]=[]);for(var r=0;r<t.length;r++)for(var i in o)t[r].title==i&&o[t[r].title].push(t[r]);for(var s in o){var c=o[s],u=O(c,1)[0],l={};u&&(l=f({},l,u)),l.data=c,n.push(l)}console.log("expect111",n),p.setState({"routeData":n})},"fail":function fail(e){console.log("getLocationList err",e)}})},p.bindGetUserInfo=function(e){console.log("bindGetUserInfo",e);var t=e.detail.userInfo;p.props.update(f({},p.props.user,t)),T.default.navigateTo({"url":"/pages/mine/index"})},p.anonymousFunc0Map={},p.customComponents=["SearchBar","Read","Destination"],_possibleConstructorReturn(p,t)}t.default=g,Component(n(0).default.createComponent(g,!0))},"32":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{"value":!0}),t.updateBanner2=t.updateBanner1=void 0,t.getBanner=function getBanner(n){return function(t){o.default.request({"url":"http://zefey.com:12345/mfw/bannerList","data":n,"success":function success(e){1==n.type?t(r(e.data.data)):2==n.type&&t(i(e.data.data))},"fail":function fail(e){console.log("bannder err",e)}})}};var o=function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}(n(0)),a=n(10);var r=t.updateBanner1=function updateBanner1(e){return{"type":a.UPDATE_BANNER1,"data":e}},i=t.updateBanner2=function updateBanner2(e){return{"type":a.UPDATE_BANNER2,"data":e}}},"33":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{"value":!0}),t.update=void 0,t.getScenic=function getScenic(e){return function(n){o.default.request({"url":"http://zefey.com:12345/mfw/scenicList","data":e,"success":function success(e){var t=e.data.data;n(r(t))},"fail":function fail(e){console.log("bannder err",e)}})}};var o=function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}(n(0)),a=n(11);var r=t.update=function update(e){return{"type":a.SCENIC_LIST,"data":e}}},"34":function(e,t,n){}},[[31,0,1]]]);